"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[6665],{87562:function(e,l,a){a.r(l),a.d(l,{default:function(){return f}});var o=a(51464),t=a(51681);const r={key:0},d={key:1,style:{display:"flex","justify-content":"space-between"}},i={class:"dialog-footer"},n={class:"dialog-footer"};function s(e,l,a,s,u,_){const m=(0,o.g2)("el-empty"),p=(0,o.g2)("el-col"),f=(0,o.g2)("el-input"),c=(0,o.g2)("el-form-item"),h=(0,o.g2)("el-cascader"),b=(0,o.g2)("el-button"),g=(0,o.g2)("el-form"),F=(0,o.g2)("el-tree"),w=(0,o.g2)("el-table-column"),k=(0,o.g2)("el-link"),y=(0,o.g2)("el-table"),V=(0,o.g2)("el-row"),v=(0,o.g2)("el-option"),C=(0,o.g2)("el-select"),I=(0,o.g2)("el-date-picker"),D=(0,o.g2)("el-dialog");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bF)(V,{gutter:40},{default:(0,o.k6)((()=>[u.form.id?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},["目录"===a.type?((0,o.uX)(),(0,o.Wv)(p,{key:0},{default:(0,o.k6)((()=>[(0,o.Lk)("h2",null,(0,t.v_)(u.form.title||"新增目录"),1),(0,o.bF)(g,{model:u.form,rules:u.rules,ref:"dialogForm","label-width":"80px","label-position":"left"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{label:"显示名称",prop:"title"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{modelValue:u.form.title,"onUpdate:modelValue":l[0]||(l[0]=e=>u.form.title=e),clearable:"",placeholder:"菜单显示名字"},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"上级菜单",prop:"parent_id"},{default:(0,o.k6)((()=>[(0,o.bF)(h,{modelValue:u.form.parent_id,"onUpdate:modelValue":l[1]||(l[1]=e=>u.form.parent_id=e),options:u.menuOptions,props:u.menuProps,"show-all-levels":!1,placeholder:"顶级菜单",clearable:"",disabled:""},null,8,["modelValue","options","props"])])),_:1}),(0,o.bF)(c,{label:"编码规则",prop:"coding_rule_"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{modelValue:u.form.coding_rule_,"onUpdate:modelValue":l[2]||(l[2]=e=>u.form.coding_rule_=e),clearable:"",placeholder:"编码规则"},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)((()=>[(0,o.bF)(b,{type:"primary",onClick:_.save,loading:u.loading},{default:(0,o.k6)((()=>l[24]||(l[24]=[(0,o.eW)("保 存")]))),_:1},8,["onClick","loading"])])),_:1})])),_:1},8,["model","rules"])])),_:1})):(0,o.Q3)("",!0),"图纸"===a.type?((0,o.uX)(),(0,o.Wv)(p,{key:1,class:"apilist"},{default:(0,o.k6)((()=>[(0,o.Lk)("h2",null,(0,t.v_)(u.form.title||"新增图纸"),1),(0,o.bF)(y,{ref:"table",data:u.drawingInfo,"highlight-current-row":"",onExpandChange:_.handleExpandChange},{default:(0,o.k6)((()=>[(0,o.bF)(w,{type:"expand",label:"全部"},{default:(0,o.k6)((e=>[(0,o.bF)(F,{data:e.row.fileList,props:u.defaultProps,"node-key":"id_","show-checkbox":"","highlight-current":""},{default:(0,o.k6)((({data:e})=>[e.children?((0,o.uX)(),(0,o.CE)("span",r,"版本：V"+(0,t.v_)(e.version),1)):((0,o.uX)(),(0,o.CE)("span",d,[(0,o.Lk)("div",null,[l[25]||(l[25]=(0,o.Lk)("i",{class:"el-icon-document"},null,-1)),(0,o.eW)(" "+(0,t.v_)(e.file_name_),1)]),(0,o.Lk)("div",null,[(0,o.bF)(b,{type:"primary",link:"",style:{}},{default:(0,o.k6)((()=>l[26]||(l[26]=[(0,o.eW)(" 查看 ")]))),_:1}),(0,o.bF)(b,{type:"primary",link:""},{default:(0,o.k6)((()=>l[27]||(l[27]=[(0,o.eW)(" 下载 ")]))),_:1}),(0,o.bF)(b,{type:"danger",link:""},{default:(0,o.k6)((()=>l[28]||(l[28]=[(0,o.eW)(" 删除 ")]))),_:1})])]))])),_:2},1032,["data","props"])])),_:1}),(0,o.bF)(w,{prop:"drawing_number_",label:"图号",width:"100"}),(0,o.bF)(w,{prop:"drawing_name_",label:"图名",width:"180"}),(0,o.bF)(w,{prop:"executor_name_",label:"执行",width:"110"}),(0,o.bF)(w,{prop:"verifier_name_",label:"校验",width:"130"}),(0,o.bF)(w,{prop:"start_date_",label:"开始时间",width:"100"}),(0,o.bF)(w,{prop:"delivery_date_",label:"交付时间",width:"100"}),(0,o.bF)(w,{prop:"status_",label:"状态",width:"70"},{default:(0,o.k6)((e=>[(0,o.bF)(k,{class:"mx-1",type:0==e.row.status_?"info":1==e.row.status_?"success":2==e.row.status_?"primary":3==e.row.status_?"danger":"default"},{default:(0,o.k6)((()=>[(0,o.eW)((0,t.v_)(0==e.row.status_?"未开始":1==e.row.status_?"执行中":2==e.row.status_?"已结束":3==e.row.status_?"已超期":"未知"),1)])),_:2},1032,["type"])])),_:1}),(0,o.bF)(w,{prop:"last_submission_",label:"最新提交",width:"100"}),(0,o.bF)(w,{prop:"current_version_",label:"当前版本",width:"80"},{default:(0,o.k6)((e=>[(0,o.eW)((0,t.v_)("V"+e.row.current_version_),1)])),_:1}),(0,o.bF)(w,{prop:"status_",label:"操作",width:"120"},{default:(0,o.k6)((e=>[(0,o.bF)(b,{text:"",type:"primary",size:"small",onClick:l=>_.openHours(e.row)},{default:(0,o.k6)((()=>l[29]||(l[29]=[(0,o.eW)("填报工时")]))),_:2},1032,["onClick"]),(0,o.bF)(b,{text:"",type:"primary",size:"small",onClick:l=>_.openDwg(e.row)},{default:(0,o.k6)((()=>l[30]||(l[30]=[(0,o.eW)("信息编辑")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onExpandChange"])])),_:1})):(0,o.Q3)("",!0)],64)):((0,o.uX)(),(0,o.Wv)(p,{key:0},{default:(0,o.k6)((()=>[(0,o.bF)(m,{description:"请选择左侧菜单后操作","image-size":100})])),_:1}))])),_:1}),(0,o.bF)(D,{modelValue:u.dialogDwg,"onUpdate:modelValue":l[12]||(l[12]=e=>u.dialogDwg=e),title:"项目详情",width:"600px"},{default:(0,o.k6)((()=>[(0,o.bF)(g,{model:u.formDwg,"label-width":"100px"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{label:"图号"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{modelValue:u.formDwg.drawing_number_,"onUpdate:modelValue":l[3]||(l[3]=e=>u.formDwg.drawing_number_=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"图名"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{modelValue:u.formDwg.drawing_name_,"onUpdate:modelValue":l[4]||(l[4]=e=>u.formDwg.drawing_name_=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"执行"},{default:(0,o.k6)((()=>[(0,o.bF)(C,{modelValue:u.formDwg.executor_name_,"onUpdate:modelValue":l[5]||(l[5]=e=>u.formDwg.executor_name_=e),placeholder:"选择执行工程师",onClick:l[6]||(l[6]=e=>_.handleNodeClick(u.formDwg.projec_id_))},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(u.projectManagers,(e=>((0,o.uX)(),(0,o.Wv)(v,{key:e.id_,label:e.fullname_,value:e.id_},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"校验"},{default:(0,o.k6)((()=>[(0,o.bF)(C,{modelValue:u.formDwg.verifier_name_,"onUpdate:modelValue":l[7]||(l[7]=e=>u.formDwg.verifier_name_=e),placeholder:"选择校验工程师",onClick:l[8]||(l[8]=e=>_.handleNodeClick(u.formDwg.projec_id_))},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(u.projectManagers,(e=>((0,o.uX)(),(0,o.Wv)(v,{key:e.id_,label:e.fullname_,value:e.id_},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"项目开始"},{default:(0,o.k6)((()=>[(0,o.bF)(I,{modelValue:u.formDwg.start_date_,"onUpdate:modelValue":l[9]||(l[9]=e=>u.formDwg.start_date_=e),type:"date",placeholder:"选择开始日期",style:{width:"100%"},disabled:""},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"项目结束"},{default:(0,o.k6)((()=>[(0,o.bF)(I,{modelValue:u.formDwg.delivery_date_,"onUpdate:modelValue":l[10]||(l[10]=e=>u.formDwg.delivery_date_=e),type:"date",placeholder:"选择结束日期",style:{width:"100%"},disabled:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),(0,o.Lk)("div",i,[(0,o.bF)(b,{onClick:l[11]||(l[11]=e=>u.dialogVisible=!1)},{default:(0,o.k6)((()=>l[31]||(l[31]=[(0,o.eW)("取消")]))),_:1}),(0,o.bF)(b,{type:"primary",onClick:e.submitForm},{default:(0,o.k6)((()=>l[32]||(l[32]=[(0,o.eW)("提交")]))),_:1},8,["onClick"])])])),_:1},8,["modelValue"]),(0,o.bF)(D,{modelValue:u.dialogVisible,"onUpdate:modelValue":l[23]||(l[23]=e=>u.dialogVisible=e),title:"工时填报",width:"500","before-close":e.handleClose},{footer:(0,o.k6)((()=>[(0,o.Lk)("div",n,[(0,o.bF)(b,{onClick:l[21]||(l[21]=e=>u.dialogVisible=!1)},{default:(0,o.k6)((()=>l[35]||(l[35]=[(0,o.eW)("Cancel")]))),_:1}),(0,o.bF)(b,{type:"primary",onClick:l[22]||(l[22]=e=>u.dialogVisible=!1)},{default:(0,o.k6)((()=>l[36]||(l[36]=[(0,o.eW)(" Confirm ")]))),_:1})])])),default:(0,o.k6)((()=>[(0,o.eW)((0,t.v_)(u.manhoursFrom)+" ",1),(0,o.bF)(g,{model:u.manhoursFrom,"label-width":"auto",style:{"max-width":"600px"}},{default:(0,o.k6)((()=>[(0,o.bF)(c,{label:"图号"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{modelValue:u.manhoursFrom.name,"onUpdate:modelValue":l[13]||(l[13]=e=>u.manhoursFrom.name=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"图名"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{modelValue:u.manhoursFrom.dwgName,"onUpdate:modelValue":l[14]||(l[14]=e=>u.manhoursFrom.dwgName=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"填报人id"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{modelValue:u.manhoursFrom.user_id_,"onUpdate:modelValue":l[15]||(l[15]=e=>u.manhoursFrom.user_id_=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"填报人姓名"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{modelValue:u.manhoursFrom.user_name_,"onUpdate:modelValue":l[16]||(l[16]=e=>u.manhoursFrom.user_name_=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"记录日期"},{default:(0,o.k6)((()=>[(0,o.bF)(p,{span:11},{default:(0,o.k6)((()=>[(0,o.bF)(I,{modelValue:u.manhoursFrom.record_data_,"onUpdate:modelValue":l[17]||(l[17]=e=>u.manhoursFrom.record_data_=e),type:"date",placeholder:"Pick a date",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),(0,o.bF)(c,{label:"填报工时"},{default:(0,o.k6)((()=>[(0,o.bF)(p,{span:11},{default:(0,o.k6)((()=>[(0,o.bF)(f,{modelValue:u.manhoursFrom.hours_,"onUpdate:modelValue":l[18]||(l[18]=e=>u.manhoursFrom.hours_=e),placeholder:"Please input"},null,8,["modelValue"])])),_:1})])),_:1}),(0,o.bF)(c,{label:"审批人"},{default:(0,o.k6)((()=>[(0,o.bF)(p,{span:11},{default:(0,o.k6)((()=>[(0,o.bF)(f,{modelValue:u.manhoursFrom.ratify_user_name_,"onUpdate:modelValue":l[19]||(l[19]=e=>u.manhoursFrom.ratify_user_name_=e),placeholder:"Please input"},null,8,["modelValue"])])),_:1})])),_:1}),(0,o.bF)(c,{label:"填报说明"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{modelValue:u.manhoursFrom.submit_message_,"onUpdate:modelValue":l[20]||(l[20]=e=>u.manhoursFrom.submit_message_=e),type:"textarea"},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)((()=>[(0,o.bF)(b,{type:"primary",onClick:e.onSubmit},{default:(0,o.k6)((()=>l[33]||(l[33]=[(0,o.eW)("Create")]))),_:1},8,["onClick"]),(0,o.bF)(b,null,{default:(0,o.k6)((()=>l[34]||(l[34]=[(0,o.eW)("Cancel")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","before-close"])],64)}a(78982),a(64660),a(89593);var u=a(76695),_={components:{scIconSelect:u.A},props:{menu:{type:Object,default:()=>{}},type:{type:String,default:"图纸"}},data(){return{dialogDwg:!1,expands:[1],dialogVisible:!1,getRowKeys:e=>e.eqId,defaultProps:{children:"children",label:"version"},form:{parentId:"",apiList:[]},projectManagers:[],formDwg:{drawing_number_:"",drawing_name_:"",executor_name_:"",verifier_name_:"",start_date_:"",delivery_date_:""},menuOptions:[],menuProps:{value:"id",label:"title",checkStrictly:!0},predefineColors:["#ff4500","#ff8c00","#ffd700","#67C23A","#00ced1","#409EFF","#c71585"],rules:[],drawingInfo:[],loading:!1,drawingFind:{projec_id_:1,drawing_menu_id_:2},fileList:[],manhoursFrom:{dwg_info_id_:"",dwgName:"",user_id_:"",user_name_:"",hours_:"",record_data_:"",submit_message_:"",ratify_user_id_:"",ratify_user_name_:""}}},watch:{dialogVisible(e){if(e){const e=this.$TOOL.data.get("USER_INFO");e?(this.manhoursFrom.user_id_=e.id_,this.manhoursFrom.user_name_=e.fullname_,console.log(this.manhoursFrom,"填报人信息已加载")):console.error("USER_INFO is undefined")}},drawingFind:{handler(){this.getDrawingInfo()},deep:!0},menu:{handler(){this.menuOptions=this.treeToMap(this.menu)},deep:!0}},mounted(){const e=this.$TOOL.data.get("USER_INFO");e?(this.manhoursFrom.user_id_=e.id_,this.manhoursFrom.user_name_=e.fullname_):console.error("USER_INFO is undefined"),this.getDrawingInfo(),this.getfileInfo()},methods:{async handleNodeClick(e){console.log(e,"sssss");const l={project_id_:e};try{const e=await this.$dmsApi.projectUsershiproute.readId.post(l);if(!e)return console.log("User not found"),null;this.projectManagers=await this.$apiIAM.user.usersByUserIds.post(e)}catch(a){console.error("Error fetching user list:",a)}},openHours(e){this.dialogVisible=!0,console.log(e,"row"),this.manhoursFrom={dwgName:e.drawing_name_,dwg_info_id_:e.id_,ratify_user_id_:e.verifier_id_,ratify_user_name_:e.verifier_name_}},openDwg(e){console.log(e,"lllll"),this.formDwg={projec_id_:e.projec_id_,drawing_number_:e.drawing_number_,drawing_name_:e.drawing_name_,executor_name_:e.executor_name_,verifier_name_:e.verifier_name_,start_date_:e.start_date_,delivery_date_:e.delivery_date_},this.dialogDwg=!0},rowContextmenu(e,l,a){this.row=e,this.$refs.table.setCurrentRow(e),this.$refs.contextmenu.openMenu(a)},async handleExpandChange(e,l){if(l&&!e.fileList){e.loading=!0;try{const l=await this.$dmsApi.fileInfo.readId.post();e.fileList=l}catch(a){console.error("Error fetching file list:",a)}finally{e.loading=!1}}},async getfileInfo(){try{return await this.$dmsApi.fileInfo.readId.post()}catch(e){console.error("Error fetching details:",e)}},handleExpand(){this.getfileInfo()},fetchDetails(e){return new Promise((l=>{setTimeout((()=>{l({data:`Details for ID: ${e}`})}),1e3)}))},async getDrawingInfo(){this.drawingInfo=await this.$dmsApi.drawingInfo.inquireList.post(this.drawingFind)},treeToMap(e){const l=[];return e.forEach((e=>{var a={id:e.id,parentId:e.parentId,title:e.title,children:e.children&&e.children.length>0?this.treeToMap(e.children):null};l.push(a)})),l},async save(){this.loading=!0;const e={id:this.form.id,name:this.form.name,path:this.form.path,component:this.form.component,title:this.form.title,icon:this.form.icon,type:this.form.type};console.log(e);var l=await this.$apiIAM.system.updetaRoute.post(e);this.loading=!1,200==l.code?this.$message.success("保存成功"):this.$message.warning(l.message)},setData(e,l){this.form=e,this.form.apiList=e.apiList||[],this.form.parentId=l,this.drawingFind.drawing_menu_id_=e.id}}},m=a(51456);const p=(0,m.A)(_,[["render",s],["__scopeId","data-v-0dac44fe"]]);var f=p}}]);