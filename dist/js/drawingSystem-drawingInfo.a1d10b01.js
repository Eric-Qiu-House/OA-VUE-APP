"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[8049],{85659:function(e,a,t){t.r(a),t.d(a,{default:function(){return h}});var n=t(20641),l=t(90033),i=t(53751);const s={class:"custom-tree-node"},o={class:"label"},d={class:"do"};function u(e,a,t,u,r,c){const m=(0,n.g2)("el-tab-pane"),p=(0,n.g2)("el-tabs"),g=(0,n.g2)("el-header"),h=(0,n.g2)("el-button"),f=(0,n.g2)("el-input"),b=(0,n.g2)("el-tree"),k=(0,n.g2)("el-main"),y=(0,n.g2)("el-footer"),F=(0,n.g2)("el-container"),v=(0,n.g2)("el-aside"),C=(0,n.g2)("save"),$=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.bF)(g,{class:"header-tabs"},{default:(0,n.k6)((()=>[(0,n.bF)(p,{type:"card",modelValue:e.groupId,"onUpdate:modelValue":a[0]||(a[0]=a=>e.groupId=a),onTabChange:e.tabChange},{default:(0,n.k6)((()=>[(0,n.bF)(m,{label:"友奇（内部）",name:"0"}),(0,n.bF)(m,{label:"船厂（外部）",name:"1"}),(0,n.bF)(m,{label:"外派（外部）",name:"4"})])),_:1},8,["modelValue","onTabChange"])])),_:1}),(0,n.bF)(F,null,{default:(0,n.k6)((()=>[(0,n.bo)(((0,n.uX)(),(0,n.Wv)(v,{width:"300px"},{default:(0,n.k6)((()=>[(0,n.bF)(F,null,{default:(0,n.k6)((()=>[(0,n.bF)(g,null,{default:(0,n.k6)((()=>[(0,n.bF)(h,{type:"primary",icon:"el-icon-plus",onClick:a[1]||(a[1]=e=>r.displayType="目录")},{default:(0,n.k6)((()=>[(0,n.eW)("目录")])),_:1}),(0,n.bF)(h,{type:"primary",icon:"el-icon-plus",onClick:a[2]||(a[2]=e=>r.displayType="图纸")},{default:(0,n.k6)((()=>[(0,n.eW)("图纸")])),_:1}),(0,n.bF)(f,{placeholder:"输入关键字进行过滤",modelValue:r.menuFilterText,"onUpdate:modelValue":a[3]||(a[3]=e=>r.menuFilterText=e),clearable:""},null,8,["modelValue"])])),_:1}),(0,n.bF)(k,{class:"nopadding"},{default:(0,n.k6)((()=>[(0,n.bF)(b,{ref:"menu",class:"menu","node-key":"id",data:r.menuList,props:r.menuProps,draggable:"","highlight-current":"","check-strictly":"","show-checkbox":"","filter-node-method":c.menuFilterNode,onNodeClick:c.menuClick,onNodeDrop:c.nodeDrop},{default:(0,n.k6)((({node:e,data:a})=>[(0,n.Lk)("span",s,[(0,n.Lk)("span",o,(0,l.v_)(e.label),1),(0,n.Lk)("span",d,[(0,n.bF)(h,{icon:"el-icon-plus",size:"small",onClick:(0,i.D$)((t=>c.add(e,a)),["stop"])},null,8,["onClick"])])])])),_:1},8,["data","props","filter-node-method","onNodeClick","onNodeDrop"])])),_:1}),(0,n.bF)(y,{style:{height:"51px"}},{default:(0,n.k6)((()=>[(0,n.bF)(h,{type:"primary",size:"small",icon:"el-icon-plus",onClick:a[4]||(a[4]=e=>c.add())}),(0,n.bF)(h,{type:"danger",size:"small",plain:"",icon:"el-icon-delete",onClick:c.delMenu},null,8,["onClick"])])),_:1})])),_:1})])),_:1})),[[$,r.menuloading]]),(0,n.bF)(F,null,{default:(0,n.k6)((()=>[(0,n.bF)(k,{class:"nopadding",style:{padding:"20px"},ref:"main"},{default:(0,n.k6)((()=>[(0,n.bF)(C,{ref:"save",menu:r.menuList,type:r.displayType},null,8,["menu","type"])])),_:1},512)])),_:1})])),_:1})],64)}var r=t(16857);let c=1;var m={name:"settingMenu",components:{save:r["default"]},data(){return{menuloading:!1,menuList:[],menuProps:{label:e=>e.title},menuFilterText:"",displayType:"图纸"}},watch:{menuFilterText(e){this.$refs.menu.filter(e)}},mounted(){this.getMenu()},methods:{async getMenu(){this.menuloading=!0;const e={project_id_:1};var a=await this.$dmsApi.drawingMenuProject.readId.post(e);this.menuloading=!1,this.menuList=a},menuClick(e,a){var t=1==a.level?void 0:a.parent.data.id;this.$refs.save.setData(e,t),this.$refs.main.$el.scrollTop=0,console.log(e,a)},menuFilterNode(e,a){if(!e)return!0;var t=a.title;return-1!==t.indexOf(e)},nodeDrop(e,a,t){this.$refs.save.setData({}),this.$message(`拖拽对象：${e.data.title}, 释放对象：${a.data.title}, 释放对象的位置：${t}`)},async add(e,a){var t="未命名"+c++,n={parent_id:a?a.id:null,name:t,path:"",component:"",title:t,type:"menu"};this.menuloading=!0,await this.$apiIAM.system.addRouter.post(n),this.getMenu(),this.menuloading=!1},async delMenu(){var e=this.$refs.menu.getCheckedNodes();if(0==e.length)return this.$message.warning("请选择需要删除的项"),!1;var a=await this.$confirm("确认删除已选择的菜单吗？","提示",{type:"warning",confirmButtonText:"删除",confirmButtonClass:"el-button--danger"}).catch((()=>{}));if("confirm"!=a)return!1;this.menuloading=!0;var t={ids:e.map((e=>e.id))},n=await this.$API.demo.post.post(t);this.menuloading=!1,200==n.code?e.forEach((e=>{var a=this.$refs.menu.getNode(e);a.isCurrent&&this.$refs.save.setData({}),this.$refs.menu.remove(e)})):this.$message.warning(n.message)}}},p=t(66262);const g=(0,p.A)(m,[["render",u],["__scopeId","data-v-4a0ea2dd"]]);var h=g}}]);