"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[2342],{27198:function(e,t,a){a.r(t),a.d(t,{default:function(){return _}});var r=a(51464),o=a(51681);function l(e,t,a,l,n,d){const i=(0,r.g2)("el-input"),s=(0,r.g2)("el-tree"),c=(0,r.g2)("el-card"),u=(0,r.g2)("el-col"),h=(0,r.g2)("el-date-picker"),p=(0,r.g2)("el-form-item"),_=(0,r.g2)("el-link"),m=(0,r.g2)("el-radio"),b=(0,r.g2)("el-radio-group"),j=(0,r.g2)("el-button"),f=(0,r.g2)("el-form"),y=(0,r.g2)("el-table-column"),g=(0,r.g2)("el-table"),k=(0,r.g2)("el-row"),D=(0,r.g2)("el-main"),v=(0,r.g2)("organize-edit"),N=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.bF)(D,null,{default:(0,r.k6)((()=>[(0,r.bF)(k,{gutter:15},{default:(0,r.k6)((()=>[(0,r.bF)(u,{lg:3},{default:(0,r.k6)((()=>[(0,r.bF)(c,{header:"项目编号"},{default:(0,r.k6)((()=>[(0,r.bF)(i,{placeholder:"输入编号进行过滤",modelValue:n.filterText,"onUpdate:modelValue":t[0]||(t[0]=e=>n.filterText=e),clearable:""},null,8,["modelValue"]),(0,r.bo)((0,r.bF)(s,{style:{"max-width":"600px"},data:n.projectData,"node-key":"project_number_",props:n.defaultProps,onNodeClick:d.handleNodeClick,"highlight-current":"","default-expand-all":"",onCheckChange:d.handleCheckChange,"filter-node-method":d.menuFilterNode,model:n.checkedKeys,"show-checkbox":"",ref:"projectTree"},null,8,["data","props","onNodeClick","onCheckChange","filter-node-method","model"]),[[N,n.proNumLoading]])])),_:1})])),_:1}),(0,r.bF)(u,{lg:21},{default:(0,r.k6)((()=>[(0,r.bF)(c,null,{default:(0,r.k6)((()=>[(0,r.bF)(f,{"label-width":"100px"},{default:(0,r.k6)((()=>[(0,r.bF)(p,{label:"查询：",style:{width:"500px"}},{default:(0,r.k6)((()=>[(0,r.bF)(h,{modelValue:n.timeHorizon,"onUpdate:modelValue":t[1]||(t[1]=e=>n.timeHorizon=e),type:"daterange","range-separator":"To",clearable:"","value-format":"YYYY-MM-DD","start-placeholder":"Start date","end-placeholder":"End date"},null,8,["modelValue"])])),_:1}),(0,r.bF)(p,{label:"统计方式："},{default:(0,r.k6)((()=>[(0,r.bF)(_,{type:"warning",underline:!1,onClick:t[2]||(t[2]=e=>d.resetFun()),style:{"margin-right":"20px"}},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.eW)("重置")]))),_:1}),(0,r.bF)(b,{modelValue:n.selectedStat,"onUpdate:modelValue":t[5]||(t[5]=e=>n.selectedStat=e)},{default:(0,r.k6)((()=>[(0,r.bF)(m,{label:"manDay",onClick:t[3]||(t[3]=e=>d.manDay())},{default:(0,r.k6)((()=>t[7]||(t[7]=[(0,r.eW)("人/天【统计】")]))),_:1}),(0,r.bF)(m,{label:"manProject",onClick:t[4]||(t[4]=e=>d.manProject())},{default:(0,r.k6)((()=>t[8]||(t[8]=[(0,r.eW)("人/项目【统计】")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,r.bF)(p,{label:"操作："},{default:(0,r.k6)((()=>[(0,r.bF)(j,{type:"primary",icon:"el-icon-plus",onClick:d.dataExport},{default:(0,r.k6)((()=>t[9]||(t[9]=[(0,r.eW)(" 数据导出 ")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{ref:"manhourData",data:n.displayedData,onSelectionChange:d.selectionChange,stripe:"","remote-sort":"","remote-filter":"","max-height":"700px"},{default:(0,r.k6)((()=>[(0,r.bF)(y,{label:"序号",width:"60"},{default:(0,r.k6)((e=>[(0,r.eW)((0,o.v_)(e.$index+1),1)])),_:1}),(0,r.bF)(y,{label:"项目",prop:"project_number_",width:"150",sortable:"custom"}),(0,r.bF)(y,{label:"项目名称",prop:"projectName",width:"150",sortable:"custom"}),(0,r.bF)(y,{label:"姓名",prop:"user_name_",width:"150",sortable:"custom"}),(0,r.bF)(y,{label:"项目类型",prop:"project_type_label",width:"150",sortable:"custom"}),(0,r.bF)(y,{label:"工作类型",prop:"job_type_label",width:"150",sortable:"custom"}),"manProject"!==n.selectedStat?((0,r.uX)(),(0,r.Wv)(y,{key:0,label:"时间",prop:"record_date_",width:"150",sortable:"custom"})):(0,r.Q3)("",!0),(0,r.bF)(y,{label:"工时",prop:"hours_",width:"150",sortable:"custom"}),"manDay"==n.selectedStat?((0,r.uX)(),(0,r.Wv)(y,{key:1,label:"加班工时",prop:"overtime",width:"150",sortable:"custom"})):(0,r.Q3)("",!0),"manDay"==n.selectedStat?((0,r.uX)(),(0,r.Wv)(y,{key:2,label:"缺失工时",prop:"lacktime",width:"150",sortable:"custom"})):(0,r.Q3)("",!0),"manProject"!==n.selectedStat?((0,r.uX)(),(0,r.Wv)(y,{key:3,label:"时间类型",prop:"overtime1",width:"150",sortable:"custom"},{default:(0,r.k6)((e=>[(0,r.Lk)("span",null,(0,o.v_)(d.detailedDateInfo(e.row.record_date_)),1)])),_:1})):(0,r.Q3)("",!0),0==n.selectedStat.length?((0,r.uX)(),(0,r.Wv)(y,{key:4,label:"备注",prop:"remark_",width:"150",sortable:"custom"})):(0,r.Q3)("",!0)])),_:1},8,["data","onSelectionChange"])),[[N,n.manhoursLoading]])])),_:1})])),_:1})])),_:1})])),_:1}),(0,r.bF)(v,{ref:"saveDialog"},null,512)],64)}a(78982),a(64660),a(40772),a(26005),a(89593),a(70426),a(84535),a(91554),a(325);var n=a(59123),d=a(74738);function i(e){const t=new Map;return e.forEach((e=>{const a=`${e.user_id_}-${e.record_date_}`;if(t.has(a)){const r=t.get(a);r.hours_+=Number(e.hours_),r.project_number_=`${r.project_number_}%${e.project_number_}`,r.project_type_=`${r.project_type_}%${e.project_type_}`,r.job_type_=`${r.job_type_}%${e.job_type_}`,r.projectName=`${r.projectName}%${e.projectName}`,r.overtime=(0,d.B1)(e.record_date_)?r.hours_:Math.max(0,r.hours_-8)}else t.set(a,{...e,hours_:Number(e.hours_),overtime:(0,d.B1)(e.record_date_)?Number(e.hours_):Math.max(0,Number(e.hours_)-8),lacktime:(0,d.B1)(e.record_date_)?"0":Math.max(0,8-Number(e.hours_))})})),Array.from(t.values())}function s(e){const t=new Map;return e.forEach((e=>{const a=`${e.user_id_}-${e.project_number_}`;t.has(a)?(t.get(a).hours_+=Number(e.hours_),t.get(a).overtime+=Number(e.overtime),t.get(a).project_type_=`${t.get(a).project_type_}%${e.project_type_}`,t.get(a).job_type_=`${t.get(a).job_type_}%${e.job_type_}`):t.set(a,{...e,hours_:Number(e.hours_)})})),Array.from(t.values())}function c(e,t){let a={};switch(t){case"manDay":a={"项目编号":"project_number_","项目名称":"projectName","姓名":"user_name_","项目类型":"project_type_label","工作类型":"job_type_label","时间":"record_date_","单日工时":"hours_","加班工时":"overtime","缺失工时":"lacktime","时间类型":"detailedDateInfo"};break;case"manProject":a={"项目编号":"project_number_","项目名称":"projectName","姓名":"user_name_","项目类型":"project_type_label","工作类型":"job_type_label","总工时":"hours_"};break;default:a={"项目编号":"project_number_","项目名称":"projectName","姓名":"user_name_","项目类型":"project_type_label","工作类型":"job_type_label","时间":"record_date_","工时":"hours_","时间类型":"detailedDateInfo"};break}const r=Object.keys(a),o=e.map((e=>r.map((t=>{const r=a[t];return"detailedDateInfo"===r?(0,d.nS)(e.record_date_):e[r]})))),l=[r.join(","),...o.map((e=>e.join(",")))].join("\n");return l}var u={data(){return{defaultProps:{label:"project_number_",children:"children"},projectId:"",filterText:"",timeHorizon:[],selectedStat:"",selection:[],projectData:[],manhourData:[],displayedData:[],proNumLoading:!1,manhoursLoading:!1,submitData:{},projectInfo:{},checkedKeys:[],dialog:{save:!1},overtimeState:!1}},components:{organizeEdit:n["default"]},created(){this.getProjectInfo()},watch:{filterText(e){this.$refs.projectTree.filter(e)},checkedKeys(){this.selectedStat="",this.handleNodeClick()},timeHorizon(){this.selectedStat="",this.handleNodeClick()}},methods:{menuFilterNode(e,t){if(!e)return!0;var a=t.project_number_;return-1!==a.indexOf(e)},resetFun(){this.selectedStat="",this.overtimeState=!1,this.handleNodeClick()},handleDateChange(e){e&&Array.isArray(e)&&(this.value1=this.value.map((e=>e?e.split("T")[0]:"")))},detailedDateInfo(e){return(0,d.nS)(e)},manDay(){this.displayedData=i(this.manhourData)},manPeriod(){const e=new Map;this.mergeManhourData.forEach((t=>{const a=`${t.user_id_}`;e.has(a)?(e.get(a).hours_+=Number(t.hours_),e.get(a).overtime+=Number(t.overtime),e.get(a).project_type_=`${e.get(a).project_type_}%${t.project_type_}`,e.get(a).job_type_=`${e.get(a).job_type_}%${t.job_type_}`):e.set(a,{...t,hours_:Number(t.hours_)})})),this.overtimeState=!0,this.displayedData=[...Array.from(e.values())]},manProject(){this.displayedData=s(this.manhourData)},isRestDay(e){return(0,d.B1)(e)},oooo(){this.$refs.saveDialog.open1()},handleCheckChange(){this.checkedKeys=this.$refs.projectTree.getCheckedKeys()},async getProjectInfo(){this.proNumLoading=!0;try{const e=await this.$dmsApi.project.readAll.get();this.projectInfo=await this.$dmsApi.project.readAll.get(),this.projectData=this.addRootNode(e)}catch(e){console.error("Error fetching project data:",e)}finally{this.proNumLoading=!1}},addRootNode(e){return[{project_number_:"所有项目",children:e}]},buildTree(e){const t={},a=[];return e.forEach((e=>{t[e.id_]={...e,children:[]}})),e.forEach((e=>{const r=t[e.parent_id];r?r.children.push(t[e.id_]):a.push(t[e.id_])})),a},async handleNodeClick(){console.log(this.projectData[0].children,"this.projectData.children.this.projectData.children."),this.submitData={project_number_:this.checkedKeys,...null!=this.timeHorizon?{start_date:this.timeHorizon[0],end_date:this.timeHorizon[1]}:{}},this.manhoursLoading=!0;try{const e=await this.$dmsApi.manHours.readFieldConversion.post(this.submitData);e.forEach((e=>{const t=this.projectData[0].children.find((t=>t.project_number_===e.project_number_));e.projectName=t?t.project_name_:""})),this.manhourData=e,this.displayedData=[...e],this.$nextTick((()=>{}))}catch(e){console.error("Error fetching manhours data:",e)}finally{this.manhoursLoading=!1}},async dataExport(){try{const e=c(this.displayedData,this.selectedStat),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(t),a.setAttribute("download","displayedData.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(e){console.error("Error exporting data:",e)}},selectionChange(e){this.selection=e}}},h=a(51456);const p=(0,h.A)(u,[["render",l]]);var _=p}}]);