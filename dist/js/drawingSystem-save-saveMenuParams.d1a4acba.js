"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[5995],{10381:function(e,l,a){a.r(l),a.d(l,{default:function(){return h}});var o=a(20641),t=a(90033);const r=e=>((0,o.Qi)("data-v-0981d2d6"),e=e(),(0,o.jt)(),e),d={key:0},i={key:1,style:{display:"flex","justify-content":"space-between"}},n=r((()=>(0,o.Lk)("i",{class:"el-icon-document"},null,-1))),s={class:"dialog-footer"},u={class:"dialog-footer"};function _(e,l,a,r,_,m){const p=(0,o.g2)("el-empty"),f=(0,o.g2)("el-col"),c=(0,o.g2)("el-input"),h=(0,o.g2)("el-form-item"),b=(0,o.g2)("el-cascader"),g=(0,o.g2)("el-button"),F=(0,o.g2)("el-form"),w=(0,o.g2)("el-tree"),k=(0,o.g2)("el-table-column"),y=(0,o.g2)("el-link"),V=(0,o.g2)("el-table"),v=(0,o.g2)("el-row"),C=(0,o.g2)("el-option"),I=(0,o.g2)("el-select"),D=(0,o.g2)("el-date-picker"),x=(0,o.g2)("el-dialog");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bF)(v,{gutter:40},{default:(0,o.k6)((()=>[_.form.id?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},["目录"===a.type?((0,o.uX)(),(0,o.Wv)(f,{key:0},{default:(0,o.k6)((()=>[(0,o.Lk)("h2",null,(0,t.v_)(_.form.title||"新增目录"),1),(0,o.bF)(F,{model:_.form,rules:_.rules,ref:"dialogForm","label-width":"80px","label-position":"left"},{default:(0,o.k6)((()=>[(0,o.bF)(h,{label:"显示名称",prop:"title"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{modelValue:_.form.title,"onUpdate:modelValue":l[0]||(l[0]=e=>_.form.title=e),clearable:"",placeholder:"菜单显示名字"},null,8,["modelValue"])])),_:1}),(0,o.bF)(h,{label:"上级菜单",prop:"parent_id"},{default:(0,o.k6)((()=>[(0,o.bF)(b,{modelValue:_.form.parent_id,"onUpdate:modelValue":l[1]||(l[1]=e=>_.form.parent_id=e),options:_.menuOptions,props:_.menuProps,"show-all-levels":!1,placeholder:"顶级菜单",clearable:"",disabled:""},null,8,["modelValue","options","props"])])),_:1}),(0,o.bF)(h,{label:"编码规则",prop:"coding_rule_"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{modelValue:_.form.coding_rule_,"onUpdate:modelValue":l[2]||(l[2]=e=>_.form.coding_rule_=e),clearable:"",placeholder:"编码规则"},null,8,["modelValue"])])),_:1}),(0,o.bF)(h,null,{default:(0,o.k6)((()=>[(0,o.bF)(g,{type:"primary",onClick:m.save,loading:_.loading},{default:(0,o.k6)((()=>[(0,o.eW)("保 存")])),_:1},8,["onClick","loading"])])),_:1})])),_:1},8,["model","rules"])])),_:1})):(0,o.Q3)("",!0),"图纸"===a.type?((0,o.uX)(),(0,o.Wv)(f,{key:1,class:"apilist"},{default:(0,o.k6)((()=>[(0,o.Lk)("h2",null,(0,t.v_)(_.form.title||"新增图纸"),1),(0,o.bF)(V,{ref:"table",data:_.drawingInfo,"highlight-current-row":"",onExpandChange:m.handleExpandChange},{default:(0,o.k6)((()=>[(0,o.bF)(k,{type:"expand",label:"全部"},{default:(0,o.k6)((e=>[(0,o.bF)(w,{data:e.row.fileList,props:_.defaultProps,"node-key":"id_","show-checkbox":"","highlight-current":""},{default:(0,o.k6)((({data:e})=>[e.children?((0,o.uX)(),(0,o.CE)("span",d,"版本：V"+(0,t.v_)(e.version),1)):((0,o.uX)(),(0,o.CE)("span",i,[(0,o.Lk)("div",null,[n,(0,o.eW)(" "+(0,t.v_)(e.file_name_),1)]),(0,o.Lk)("div",null,[(0,o.bF)(g,{type:"primary",link:"",style:{}},{default:(0,o.k6)((()=>[(0,o.eW)(" 查看 ")])),_:1}),(0,o.bF)(g,{type:"primary",link:""},{default:(0,o.k6)((()=>[(0,o.eW)(" 下载 ")])),_:1}),(0,o.bF)(g,{type:"danger",link:""},{default:(0,o.k6)((()=>[(0,o.eW)(" 删除 ")])),_:1})])]))])),_:2},1032,["data","props"])])),_:1}),(0,o.bF)(k,{prop:"drawing_number_",label:"图号",width:"100"}),(0,o.bF)(k,{prop:"drawing_name_",label:"图名",width:"180"}),(0,o.bF)(k,{prop:"executor_name_",label:"执行",width:"110"}),(0,o.bF)(k,{prop:"verifier_name_",label:"校验",width:"130"}),(0,o.bF)(k,{prop:"start_date_",label:"开始时间",width:"100"}),(0,o.bF)(k,{prop:"delivery_date_",label:"交付时间",width:"100"}),(0,o.bF)(k,{prop:"status_",label:"状态",width:"70"},{default:(0,o.k6)((e=>[(0,o.bF)(y,{class:"mx-1",type:0==e.row.status_?"info":1==e.row.status_?"success":2==e.row.status_?"primary":3==e.row.status_?"danger":"default"},{default:(0,o.k6)((()=>[(0,o.eW)((0,t.v_)(0==e.row.status_?"未开始":1==e.row.status_?"执行中":2==e.row.status_?"已结束":3==e.row.status_?"已超期":"未知"),1)])),_:2},1032,["type"])])),_:1}),(0,o.bF)(k,{prop:"last_submission_",label:"最新提交",width:"100"}),(0,o.bF)(k,{prop:"current_version_",label:"当前版本",width:"80"},{default:(0,o.k6)((e=>[(0,o.eW)((0,t.v_)("V"+e.row.current_version_),1)])),_:1}),(0,o.bF)(k,{prop:"status_",label:"操作",width:"120"},{default:(0,o.k6)((e=>[(0,o.bF)(g,{text:"",type:"primary",size:"small",onClick:l=>m.openHours(e.row)},{default:(0,o.k6)((()=>[(0,o.eW)("填报工时")])),_:2},1032,["onClick"]),(0,o.bF)(g,{text:"",type:"primary",size:"small",onClick:l=>m.openDwg(e.row)},{default:(0,o.k6)((()=>[(0,o.eW)("信息编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onExpandChange"])])),_:1})):(0,o.Q3)("",!0)],64)):((0,o.uX)(),(0,o.Wv)(f,{key:0},{default:(0,o.k6)((()=>[(0,o.bF)(p,{description:"请选择左侧菜单后操作","image-size":100})])),_:1}))])),_:1}),(0,o.bF)(x,{modelValue:_.dialogDwg,"onUpdate:modelValue":l[12]||(l[12]=e=>_.dialogDwg=e),title:"项目详情",width:"600px"},{default:(0,o.k6)((()=>[(0,o.bF)(F,{model:_.formDwg,"label-width":"100px"},{default:(0,o.k6)((()=>[(0,o.bF)(h,{label:"图号"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{modelValue:_.formDwg.drawing_number_,"onUpdate:modelValue":l[3]||(l[3]=e=>_.formDwg.drawing_number_=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,o.bF)(h,{label:"图名"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{modelValue:_.formDwg.drawing_name_,"onUpdate:modelValue":l[4]||(l[4]=e=>_.formDwg.drawing_name_=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(h,{label:"执行"},{default:(0,o.k6)((()=>[(0,o.bF)(I,{modelValue:_.formDwg.executor_name_,"onUpdate:modelValue":l[5]||(l[5]=e=>_.formDwg.executor_name_=e),placeholder:"选择执行工程师",onClick:l[6]||(l[6]=e=>m.handleNodeClick(_.formDwg.projec_id_))},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(_.projectManagers,(e=>((0,o.uX)(),(0,o.Wv)(C,{key:e.id_,label:e.fullname_,value:e.id_},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,o.bF)(h,{label:"校验"},{default:(0,o.k6)((()=>[(0,o.bF)(I,{modelValue:_.formDwg.verifier_name_,"onUpdate:modelValue":l[7]||(l[7]=e=>_.formDwg.verifier_name_=e),placeholder:"选择校验工程师",onClick:l[8]||(l[8]=e=>m.handleNodeClick(_.formDwg.projec_id_))},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(_.projectManagers,(e=>((0,o.uX)(),(0,o.Wv)(C,{key:e.id_,label:e.fullname_,value:e.id_},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,o.bF)(h,{label:"项目开始"},{default:(0,o.k6)((()=>[(0,o.bF)(D,{modelValue:_.formDwg.start_date_,"onUpdate:modelValue":l[9]||(l[9]=e=>_.formDwg.start_date_=e),type:"date",placeholder:"选择开始日期",style:{width:"100%"},disabled:""},null,8,["modelValue"])])),_:1}),(0,o.bF)(h,{label:"项目结束"},{default:(0,o.k6)((()=>[(0,o.bF)(D,{modelValue:_.formDwg.delivery_date_,"onUpdate:modelValue":l[10]||(l[10]=e=>_.formDwg.delivery_date_=e),type:"date",placeholder:"选择结束日期",style:{width:"100%"},disabled:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),(0,o.Lk)("div",s,[(0,o.bF)(g,{onClick:l[11]||(l[11]=e=>_.dialogVisible=!1)},{default:(0,o.k6)((()=>[(0,o.eW)("取消")])),_:1}),(0,o.bF)(g,{type:"primary",onClick:e.submitForm},{default:(0,o.k6)((()=>[(0,o.eW)("提交")])),_:1},8,["onClick"])])])),_:1},8,["modelValue"]),(0,o.bF)(x,{modelValue:_.dialogVisible,"onUpdate:modelValue":l[23]||(l[23]=e=>_.dialogVisible=e),title:"工时填报",width:"500","before-close":e.handleClose},{footer:(0,o.k6)((()=>[(0,o.Lk)("div",u,[(0,o.bF)(g,{onClick:l[21]||(l[21]=e=>_.dialogVisible=!1)},{default:(0,o.k6)((()=>[(0,o.eW)("Cancel")])),_:1}),(0,o.bF)(g,{type:"primary",onClick:l[22]||(l[22]=e=>_.dialogVisible=!1)},{default:(0,o.k6)((()=>[(0,o.eW)(" Confirm ")])),_:1})])])),default:(0,o.k6)((()=>[(0,o.eW)((0,t.v_)(_.manhoursFrom)+" ",1),(0,o.bF)(F,{model:_.manhoursFrom,"label-width":"auto",style:{"max-width":"600px"}},{default:(0,o.k6)((()=>[(0,o.bF)(h,{label:"图号"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{modelValue:_.manhoursFrom.name,"onUpdate:modelValue":l[13]||(l[13]=e=>_.manhoursFrom.name=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(h,{label:"图名"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{modelValue:_.manhoursFrom.dwgName,"onUpdate:modelValue":l[14]||(l[14]=e=>_.manhoursFrom.dwgName=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(h,{label:"填报人id"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{modelValue:_.manhoursFrom.user_id_,"onUpdate:modelValue":l[15]||(l[15]=e=>_.manhoursFrom.user_id_=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(h,{label:"填报人姓名"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{modelValue:_.manhoursFrom.user_name_,"onUpdate:modelValue":l[16]||(l[16]=e=>_.manhoursFrom.user_name_=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(h,{label:"记录日期"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{span:11},{default:(0,o.k6)((()=>[(0,o.bF)(D,{modelValue:_.manhoursFrom.record_data_,"onUpdate:modelValue":l[17]||(l[17]=e=>_.manhoursFrom.record_data_=e),type:"date",placeholder:"Pick a date",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),(0,o.bF)(h,{label:"填报工时"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{span:11},{default:(0,o.k6)((()=>[(0,o.bF)(c,{modelValue:_.manhoursFrom.hours_,"onUpdate:modelValue":l[18]||(l[18]=e=>_.manhoursFrom.hours_=e),placeholder:"Please input"},null,8,["modelValue"])])),_:1})])),_:1}),(0,o.bF)(h,{label:"审批人"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{span:11},{default:(0,o.k6)((()=>[(0,o.bF)(c,{modelValue:_.manhoursFrom.ratify_user_name_,"onUpdate:modelValue":l[19]||(l[19]=e=>_.manhoursFrom.ratify_user_name_=e),placeholder:"Please input"},null,8,["modelValue"])])),_:1})])),_:1}),(0,o.bF)(h,{label:"填报说明"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{modelValue:_.manhoursFrom.submit_message_,"onUpdate:modelValue":l[20]||(l[20]=e=>_.manhoursFrom.submit_message_=e),type:"textarea"},null,8,["modelValue"])])),_:1}),(0,o.bF)(h,null,{default:(0,o.k6)((()=>[(0,o.bF)(g,{type:"primary",onClick:e.onSubmit},{default:(0,o.k6)((()=>[(0,o.eW)("Create")])),_:1},8,["onClick"]),(0,o.bF)(g,null,{default:(0,o.k6)((()=>[(0,o.eW)("Cancel")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","before-close"])],64)}a(28743);var m=a(67978),p={components:{scIconSelect:m.A},props:{menu:{type:Object,default:()=>{}},type:{type:String,default:"图纸"}},data(){return{dialogDwg:!1,expands:[1],dialogVisible:!1,getRowKeys:e=>e.eqId,defaultProps:{children:"children",label:"version"},form:{parentId:"",apiList:[]},projectManagers:[],formDwg:{drawing_number_:"",drawing_name_:"",executor_name_:"",verifier_name_:"",start_date_:"",delivery_date_:""},menuOptions:[],menuProps:{value:"id",label:"title",checkStrictly:!0},predefineColors:["#ff4500","#ff8c00","#ffd700","#67C23A","#00ced1","#409EFF","#c71585"],rules:[],drawingInfo:[],loading:!1,drawingFind:{projec_id_:1,drawing_menu_id_:2},fileList:[],manhoursFrom:{dwg_info_id_:"",dwgName:"",user_id_:"",user_name_:"",hours_:"",record_data_:"",submit_message_:"",ratify_user_id_:"",ratify_user_name_:""}}},watch:{dialogVisible(e){if(e){const e=this.$TOOL.data.get("USER_INFO");e?(this.manhoursFrom.user_id_=e.id_,this.manhoursFrom.user_name_=e.fullname_,console.log(this.manhoursFrom,"填报人信息已加载")):console.error("USER_INFO is undefined")}},drawingFind:{handler(){this.getDrawingInfo()},deep:!0},menu:{handler(){this.menuOptions=this.treeToMap(this.menu)},deep:!0}},mounted(){const e=this.$TOOL.data.get("USER_INFO");e?(this.manhoursFrom.user_id_=e.id_,this.manhoursFrom.user_name_=e.fullname_):console.error("USER_INFO is undefined"),this.getDrawingInfo(),this.getfileInfo()},methods:{async handleNodeClick(e){console.log(e,"sssss");const l={project_id_:e};try{const e=await this.$dmsApi.projectUsershiproute.readId.post(l);if(!e)return console.log("User not found"),null;this.projectManagers=await this.$apiIAM.user.usersByUserIds.post(e)}catch(a){console.error("Error fetching user list:",a)}},openHours(e){this.dialogVisible=!0,console.log(e,"row"),this.manhoursFrom={dwgName:e.drawing_name_,dwg_info_id_:e.id_,ratify_user_id_:e.verifier_id_,ratify_user_name_:e.verifier_name_}},openDwg(e){console.log(e,"lllll"),this.formDwg={projec_id_:e.projec_id_,drawing_number_:e.drawing_number_,drawing_name_:e.drawing_name_,executor_name_:e.executor_name_,verifier_name_:e.verifier_name_,start_date_:e.start_date_,delivery_date_:e.delivery_date_},this.dialogDwg=!0},rowContextmenu(e,l,a){this.row=e,this.$refs.table.setCurrentRow(e),this.$refs.contextmenu.openMenu(a)},async handleExpandChange(e,l){if(l&&!e.fileList){e.loading=!0;try{const l=await this.$dmsApi.fileInfo.readId.post();e.fileList=l}catch(a){console.error("Error fetching file list:",a)}finally{e.loading=!1}}},async getfileInfo(){try{return await this.$dmsApi.fileInfo.readId.post()}catch(e){console.error("Error fetching details:",e)}},handleExpand(){this.getfileInfo()},fetchDetails(e){return new Promise((l=>{setTimeout((()=>{l({data:`Details for ID: ${e}`})}),1e3)}))},async getDrawingInfo(){this.drawingInfo=await this.$dmsApi.drawingInfo.inquireList.post(this.drawingFind)},treeToMap(e){const l=[];return e.forEach((e=>{var a={id:e.id,parentId:e.parentId,title:e.title,children:e.children&&e.children.length>0?this.treeToMap(e.children):null};l.push(a)})),l},async save(){this.loading=!0;const e={id:this.form.id,name:this.form.name,path:this.form.path,component:this.form.component,title:this.form.title,icon:this.form.icon,type:this.form.type};console.log(e);var l=await this.$apiIAM.system.updetaRoute.post(e);this.loading=!1,200==l.code?this.$message.success("保存成功"):this.$message.warning(l.message)},setData(e,l){this.form=e,this.form.apiList=e.apiList||[],this.form.parentId=l,this.drawingFind.drawing_menu_id_=e.id}}},f=a(66262);const c=(0,f.A)(p,[["render",_],["__scopeId","data-v-0981d2d6"]]);var h=c}}]);